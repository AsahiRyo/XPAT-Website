<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Your Journey - X'PAT</title>
    <meta name="description" content="From dreams to reality - Play through your journey in Malaysia with X'PAT.">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Press+Start+2P&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-blue: #0118D8;
            --secondary-blue: #1B56FD;
            --cream: #E9DFC3;
            --off-white: #FFF8F8;
            --text-primary: #FFF8F8;
            --text-secondary: #E9DFC3;
            --glass-bg: rgba(1, 24, 216, 0.15);
            --glass-border: rgba(233, 223, 195, 0.3);
            --glass-strong: rgba(27, 86, 253, 0.25);
            --shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
            --radius: 24px;
            --blur: blur(30px);
            --container-padding: clamp(16px, 4vw, 48px);
            --section-spacing: clamp(60px, 8vw, 100px);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html {
            scroll-behavior: smooth;
            font-size: 16px;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #000814;
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            position: relative;
            touch-action: pan-y;
        }

        /* Animated Liquid Background */
        .liquid-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
            background: linear-gradient(135deg, #000814 0%, #001233 50%, #000814 100%);
        }

        .liquid-blob {
            position: absolute;
            border-radius: 40% 60% 70% 30% / 40% 50% 60% 50%;
            filter: blur(80px);
            opacity: 0.5;
            mix-blend-mode: screen;
            animation: morph 15s ease-in-out infinite, float 20s ease-in-out infinite;
        }

        .blob-1 {
            width: 600px;
            height: 600px;
            background: radial-gradient(circle, #0118D8, #1B56FD);
            top: 10%;
            left: -15%;
        }

        .blob-2 {
            width: 700px;
            height: 700px;
            background: radial-gradient(circle, #1B56FD, #0118D8);
            top: 40%;
            right: -20%;
            animation-delay: -5s;
        }

        .blob-3 {
            width: 550px;
            height: 550px;
            background: radial-gradient(circle, #0118D8, #1B56FD);
            bottom: 5%;
            left: 25%;
            animation-delay: -10s;
        }

        @keyframes morph {
            0%, 100% {
                border-radius: 40% 60% 70% 30% / 40% 50% 60% 50%;
                transform: rotate(0deg) scale(1);
            }
            50% {
                border-radius: 50% 50% 30% 70% / 50% 40% 60% 40%;
                transform: rotate(180deg) scale(0.9);
            }
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0); }
            50% { transform: translate(-40px, 40px); }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 var(--container-padding);
            width: 100%;
        }

        /* Hero Section */
        .hero-section {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 999;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: clamp(12px, 2.5vw, 18px) clamp(20px, 4vw, 36px);
            border-radius: 16px;
            font-size: clamp(13px, 2.5vw, 17px);
            font-weight: 600;
            text-decoration: none;
            transition: all 0.2s ease;
            border: none;
            cursor: pointer;
            white-space: nowrap;
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--secondary-blue) 100%);
            color: var(--off-white);
            box-shadow: 0 10px 30px rgba(1, 24, 216, 0.4);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 40px rgba(27, 86, 253, 0.5);
        }

        .btn:active {
            transform: translateY(0);
        }

        /* Progress Bar */
        .story-progress-bar {
            position: fixed;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            z-index: 100;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .progress-dot {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            background: rgba(100, 100, 100, 0.5);
            border: 2px solid rgba(233, 223, 195, 0.3);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }

        .progress-dot::before {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            width: 2px;
            height: 10px;
            background: rgba(233, 223, 195, 0.2);
        }

        .progress-dot:last-child::before {
            display: none;
        }

        .progress-dot.active {
            background: #1B56FD;
            border-color: #1B56FD;
            box-shadow: 0 0 20px rgba(27, 86, 253, 0.6);
        }

        .progress-dot.completed {
            background: #FFD700;
            border-color: #FFD700;
        }

        @media (max-width: 768px) {
            .hero-section {
                top: 10px;
                left: 10px;
            }
            
            .story-progress-bar {
                right: 8px;
                gap: 8px;
            }
            
            .progress-dot {
                width: 14px;
                height: 14px;
            }
        }

        /* Story Section */
        .story-section {
            padding: clamp(80px, 12vh, 120px) 0 var(--section-spacing);
            position: relative;
        }

        .story-stage {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: clamp(30px, 5vw, 60px);
            align-items: center;
            margin-bottom: clamp(60px, 8vw, 100px);
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
        }

        .story-stage:nth-child(even) {
            direction: rtl;
        }

        .story-stage:nth-child(even) > * {
            direction: ltr;
        }

        .story-content {
            padding: clamp(15px, 3vw, 30px);
        }

        .stage-label {
            font-size: clamp(12px, 2vw, 15px);
            color: #FFD700;
            font-weight: 700;
            margin-bottom: clamp(10px, 1.5vw, 14px);
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .story-title {
            font-size: clamp(24px, 4vw, 42px);
            font-weight: 800;
            margin-bottom: clamp(14px, 2.5vw, 20px);
            color: var(--off-white);
            line-height: 1.2;
        }

        .story-description {
            font-size: clamp(15px, 2.5vw, 18px);
            color: var(--cream);
            line-height: 1.6;
            margin-bottom: clamp(20px, 3vw, 28px);
        }

        .story-cta {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: clamp(10px, 2vw, 14px) clamp(20px, 3.5vw, 28px);
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--secondary-blue) 100%);
            color: var(--off-white);
            text-decoration: none;
            border-radius: 14px;
            font-weight: 600;
            font-size: clamp(13px, 2vw, 15px);
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(1, 24, 216, 0.4);
        }

        .story-cta:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 40px rgba(27, 86, 253, 0.6);
        }

        .story-cta:active {
            transform: translateY(0);
        }

        /* Game Canvas Container */
        .game-container {
            background: rgba(0, 8, 20, 0.9);
            backdrop-filter: var(--blur);
            border: 2px solid var(--glass-border);
            border-radius: var(--radius);
            padding: clamp(15px, 3vw, 25px);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: clamp(350px, 50vw, 500px);
            box-shadow: 0 20px 60px rgba(1, 24, 216, 0.3);
            position: relative;
        }

        .game-canvas {
            border: 3px solid #FFD700;
            background: #000;
            border-radius: 8px;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
            max-width: 100%;
            height: auto;
            cursor: pointer;
            touch-action: none;
        }

        .game-info {
            font-family: 'Press Start 2P', cursive;
            color: #FFD700;
            font-size: clamp(8px, 2vw, 12px);
            margin-top: 12px;
            text-align: center;
            text-shadow: 2px 2px 0 #000;
            line-height: 1.4;
        }

        .game-score {
            font-family: 'Press Start 2P', cursive;
            color: #00FF00;
            font-size: clamp(10px, 2.5vw, 16px);
            margin-top: 8px;
            text-shadow: 2px 2px 0 #000;
        }

        /* Mobile Controls */
        .mobile-controls {
            display: none;
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            gap: 15px;
            z-index: 10;
        }

        .control-btn {
            width: 60px;
            height: 60px;
            background: rgba(255, 215, 0, 0.3);
            border: 2px solid #FFD700;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: #FFD700;
            cursor: pointer;
            user-select: none;
            touch-action: manipulation;
            font-weight: bold;
        }

        .control-btn:active {
            background: rgba(255, 215, 0, 0.5);
            transform: scale(0.95);
        }

        @media (max-width: 768px) {
            .story-stage {
                grid-template-columns: 1fr;
                gap: 30px;
            }

            .story-stage:nth-child(even) {
                direction: ltr;
            }

            .game-container {
                min-height: 400px;
            }

            .mobile-controls {
                display: flex;
            }
        }

        @media (max-width: 480px) {
            .game-canvas {
                width: 100% !important;
                height: auto !important;
            }
            
            .control-btn {
                width: 50px;
                height: 50px;
                font-size: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Animated Liquid Background -->
    <div class="liquid-background">
        <div class="liquid-blob blob-1"></div>
        <div class="liquid-blob blob-2"></div>
        <div class="liquid-blob blob-3"></div>
    </div>

    <!-- Return Home Button -->
    <section class="hero-section">
        <div class="container">
            <a href="index.html" class="btn">← Home</a>
        </div>
    </section>

    <!-- Story Section -->
    <section class="story-section" id="story">
        <!-- Progress Bar -->
        <div class="story-progress-bar" id="storyProgressBar">
            <div class="progress-dot" data-stage="0"></div>
            <div class="progress-dot" data-stage="1"></div>
            <div class="progress-dot" data-stage="2"></div>
            <div class="progress-dot" data-stage="3"></div>
            <div class="progress-dot" data-stage="4"></div>
            <div class="progress-dot" data-stage="5"></div>
            <div class="progress-dot" data-stage="6"></div>
            <div class="progress-dot" data-stage="7"></div>
            <div class="progress-dot" data-stage="8"></div>
        </div>

        <div class="container">
            <!-- Stage 01: Dream Catcher -->
            <div class="story-stage" data-stage="0">
                <div class="story-content">
                    <div class="stage-label">STAGE 01</div>
                    <h3 class="story-title">Dreaming of Malaysia</h3>
                    <p class="story-description">Catch falling stars while avoiding obstacles. Each star represents a dream of a better future in Malaysia!</p>
                </div>
                <div class="game-container">
                    <canvas id="game1" class="game-canvas" width="400" height="400"></canvas>
                    <div class="game-info">Move Left/Right • Tap to Start</div>
                    <div class="game-score" id="score1">Score: 0</div>
                    <div class="mobile-controls" id="controls1">
                        <div class="control-btn" data-key="left">←</div>
                        <div class="control-btn" data-key="right">→</div>
                    </div>
                </div>
            </div>

            <!-- Stage 02: Airport Rush -->
            <div class="story-stage" data-stage="1">
                <div class="story-content">
                    <div class="stage-label">STAGE 02</div>
                    <h3 class="story-title">Taking Flight</h3>
                    <p class="story-description">Navigate through airport security! Dodge obstacles and collect boarding passes to reach your gate.</p>
                    <a href="https://linktr.ee/tfpsolutionsofficial" target="_blank" class="story-cta">
                        ✈️ X'PAT Air Tickets
                    </a>
                </div>
                <div class="game-container">
                    <canvas id="game2" class="game-canvas" width="400" height="400"></canvas>
                    <div class="game-info">Move Up/Down • Tap to Start</div>
                    <div class="game-score" id="score2">Score: 0</div>
                    <div class="mobile-controls" id="controls2">
                        <div class="control-btn" data-key="up">↑</div>
                        <div class="control-btn" data-key="down">↓</div>
                    </div>
                </div>
            </div>

            <!-- Stage 03: Cloud Dodger -->
            <div class="story-stage" data-stage="2">
                <div class="story-content">
                    <div class="stage-label">STAGE 03</div>
                    <h3 class="story-title">Journey Through The Clouds</h3>
                    <p class="story-description">Fly vertically and dodge bad clouds! Navigate carefully to reach Malaysia safely.</p>
                </div>
                <div class="game-container">
                    <canvas id="game3" class="game-canvas" width="400" height="400"></canvas>
                    <div class="game-info">Move Left/Right • Tap to Start</div>
                    <div class="game-score" id="score3">Score: 0</div>
                    <div class="mobile-controls" id="controls3">
                        <div class="control-btn" data-key="left">←</div>
                        <div class="control-btn" data-key="right">→</div>
                    </div>
                </div>
            </div>

            <!-- Stage 04: Visa Puzzle -->
            <div class="story-stage" data-stage="3">
                <div class="story-content">
                    <div class="stage-label">STAGE 04</div>
                    <h3 class="story-title">Welcome to Malaysia</h3>
                    <p class="story-description">Match passport stamps in this memory game! Complete your documentation to enter Malaysia.</p>
                    <a href="https://linktr.ee/tfpsolutionsofficial" target="_blank" class="story-cta">
                        📋 X'PAT Visa Renewal
                    </a>
                </div>
                <div class="game-container">
                    <canvas id="game4" class="game-canvas" width="400" height="400"></canvas>
                    <div class="game-info">Tap Cards to Match</div>
                    <div class="game-score" id="score4">Pairs: 0/8</div>
                </div>
            </div>

            <!-- Stage 05: Signal Connect -->
            <div class="story-stage" data-stage="4">
                <div class="story-content">
                    <div class="stage-label">STAGE 05</div>
                    <h3 class="story-title">Staying Connected</h3>
                    <p class="story-description">Create a path to connect the signal towers! Stay connected with your loved ones back home.</p>
                    <a href="https://linktr.ee/tfpsolutionsofficial" target="_blank" class="story-cta">
                        📱 X'PAT S4S Mobile
                    </a>
                </div>
                <div class="game-container">
                    <canvas id="game5" class="game-canvas" width="400" height="400"></canvas>
                    <div class="game-info">Tap Tiles to Connect</div>
                    <div class="game-score" id="score5">Moves: 0</div>
                </div>
            </div>

            <!-- Stage 06: Builder's Challenge -->
            <div class="story-stage" data-stage="5">
                <div class="story-content">
                    <div class="stage-label">STAGE 06</div>
                    <h3 class="story-title">Building Your Future</h3>
                    <p class="story-description">Stack blocks perfectly to build your future! Each perfect stack earns you more.</p>
                    <a href="https://linktr.ee/tfpsolutionsofficial" target="_blank" class="story-cta">
                        💼 X'PAT E-Wages
                    </a>
                </div>
                <div class="game-container">
                    <canvas id="game6" class="game-canvas" width="400" height="400"></canvas>
                    <div class="game-info">Tap to Drop Block</div>
                    <div class="game-score" id="score6">Height: 0</div>
                </div>
            </div>

            <!-- Stage 07: Money Runner -->
            <div class="story-stage" data-stage="6">
                <div class="story-content">
                    <div class="stage-label">STAGE 07</div>
                    <h3 class="story-title">Supporting Your Family</h3>
                    <p class="story-description">Collect coins while jumping over obstacles! Every ringgit counts for your family.</p>
                    <a href="https://linktr.ee/tfpsolutionsofficial" target="_blank" class="story-cta">
                        💸 X'PAT Remittance
                    </a>
                </div>
                <div class="game-container">
                    <canvas id="game7" class="game-canvas" width="400" height="400"></canvas>
                    <div class="game-info">Tap to Jump</div>
                    <div class="game-score" id="score7">Coins: 0</div>
                </div>
            </div>

            <!-- Stage 08: Coin Collector -->
            <div class="story-stage" data-stage="7">
                <div class="story-content">
                    <div class="stage-label">STAGE 08</div>
                    <h3 class="story-title">Growing Your Wealth</h3>
                    <p class="story-description">Click coins to collect them before they disappear! Build your savings quickly.</p>
                    <a href="https://linktr.ee/tfpsolutionsofficial" target="_blank" class="story-cta">
                        💰 X'PAT MiPay
                    </a>
                </div>
                <div class="game-container">
                    <canvas id="game8" class="game-canvas" width="400" height="400"></canvas>
                    <div class="game-info">Tap Coins Fast!</div>
                    <div class="game-score" id="score8">Savings: 0</div>
                </div>
            </div>

            <!-- Stage 09: Fireworks -->
            <div class="story-stage" data-stage="8">
                <div class="story-content">
                    <div class="stage-label">STAGE 09</div>
                    <h3 class="story-title">You Made It!</h3>
                    <p class="story-description">Celebrate your success! Click to create fireworks and celebrate your journey from dreams to reality.</p>
                    <a href="index.html#download" class="story-cta">
                        🎉 Download X'PAT Now
                    </a>
                </div>
                <div class="game-container">
                    <canvas id="game9" class="game-canvas" width="400" height="400"></canvas>
                    <div class="game-info">Tap for Fireworks!</div>
                    <div class="game-score" id="score9">Explosions: 0</div>
                </div>
            </div>
        </div>
    </section>

    <script>
        // ===== RESPONSIVE CANVAS MANAGEMENT =====
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || window.innerWidth < 768;
        
        function getCanvasSize() {
            if (window.innerWidth < 480) return 320;
            if (window.innerWidth < 768) return 380;
            return 400;
        }

        function resizeCanvas(canvas) {
            const size = getCanvasSize();
            canvas.width = size;
            canvas.height = size;
        }

        // ===== GLOBAL GAME MANAGEMENT =====
        let currentActiveGame = null;
        const allGames = [];
        const keys = {};
        const touches = {};

        class Game {
            constructor(id, canvas, scoreElement) {
                this.id = id;
                this.canvas = canvas;
                this.ctx = canvas.getContext('2d');
                this.scoreElement = scoreElement;
                this.active = false;
                this.started = false;
                this.animationFrame = null;
                this.canvasSize = canvas.width;
                allGames.push(this);
                
                // Scale factor for responsive sizing
                this.scale = this.canvasSize / 400;
            }

            activate() {
                if (currentActiveGame && currentActiveGame !== this) {
                    currentActiveGame.deactivate();
                }
                this.active = true;
                currentActiveGame = this;
            }

            deactivate() {
                this.active = false;
                this.started = false;
                if (this.animationFrame) {
                    cancelAnimationFrame(this.animationFrame);
                    this.animationFrame = null;
                }
            }

            reset() {
                this.deactivate();
                this.canvasSize = this.canvas.width;
                this.scale = this.canvasSize / 400;
                this.init();
            }

            s(value) {
                return value * this.scale;
            }
        }

        // ===== INPUT HANDLERS =====
        window.addEventListener('keydown', (e) => {
            if (currentActiveGame && ['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight', ' ', 'w', 'a', 's', 'd'].includes(e.key.toLowerCase())) {
                e.preventDefault();
            }
            keys[e.key.toLowerCase()] = true;
        });

        window.addEventListener('keyup', (e) => {
            keys[e.key.toLowerCase()] = false;
        });

        // Touch controls for mobile
        document.querySelectorAll('.control-btn').forEach(btn => {
            btn.addEventListener('touchstart', (e) => {
                e.preventDefault();
                const key = btn.getAttribute('data-key');
                touches[key] = true;
            });
            
            btn.addEventListener('touchend', (e) => {
                e.preventDefault();
                const key = btn.getAttribute('data-key');
                touches[key] = false;
            });

            btn.addEventListener('mousedown', (e) => {
                e.preventDefault();
                const key = btn.getAttribute('data-key');
                touches[key] = true;
            });
            
            btn.addEventListener('mouseup', (e) => {
                e.preventDefault();
                const key = btn.getAttribute('data-key');
                touches[key] = false;
            });
        });

        // ===== GAME 1: DREAM CATCHER =====
        class DreamCatcher extends Game {
            constructor() {
                const canvas = document.getElementById('game1');
                resizeCanvas(canvas);
                super('game1', canvas, document.getElementById('score1'));
                this.init();
            }

            init() {
                this.score = 0;
                this.player = { 
                    x: this.s(200), 
                    y: this.s(350), 
                    width: this.s(40), 
                    height: this.s(40), 
                    speed: this.s(5) 
                };
                this.stars = [];
                this.obstacles = [];
                this.scoreElement.textContent = 'Score: 0';
                this.drawStartScreen();
            }

            drawStartScreen() {
                this.ctx.fillStyle = '#000';
                this.ctx.fillRect(0, 0, this.canvasSize, this.canvasSize);
                this.ctx.fillStyle = '#FFD700';
                this.ctx.font = `${this.s(16)}px "Press Start 2P"`;
                this.ctx.textAlign = 'center';
                this.ctx.fillText('DREAM CATCHER', this.s(200), this.s(150));
                this.ctx.font = `${this.s(10)}px "Press Start 2P"`;
                this.ctx.fillText('Catch stars!', this.s(200), this.s(200));
                this.ctx.fillText('Avoid obstacles!', this.s(200), this.s(230));
                this.ctx.fillText('Tap/Click to start', this.s(200), this.s(280));
            }

            start() {
                this.activate();
                this.started = true;
                this.gameLoop();
            }

            gameLoop() {
                if (!this.active || !this.started) return;

                this.ctx.fillStyle = '#000';
                this.ctx.fillRect(0, 0, this.canvasSize, this.canvasSize);

                // Move player
                if ((keys['a'] || keys['arrowleft'] || touches['left']) && this.player.x > 0) {
                    this.player.x -= this.player.speed;
                }
                if ((keys['d'] || keys['arrowright'] || touches['right']) && this.player.x < this.canvasSize - this.player.width) {
                    this.player.x += this.player.speed;
                }

                // Draw player
                this.ctx.fillStyle = '#8B4513';
                this.ctx.fillRect(this.player.x, this.player.y, this.player.width, this.player.height);

                // Spawn items
                if (Math.random() < 0.02) {
                    this.stars.push({
                        x: Math.random() * (this.canvasSize - this.s(40)) + this.s(20),
                        y: 0,
                        size: this.s(15),
                        speed: this.s(2) + Math.random() * this.s(2)
                    });
                }
                if (Math.random() < 0.015) {
                    this.obstacles.push({
                        x: Math.random() * (this.canvasSize - this.s(40)) + this.s(20),
                        y: 0,
                        size: this.s(20),
                        speed: this.s(3) + Math.random() * this.s(2)
                    });
                }

                // Update stars
                for (let i = this.stars.length - 1; i >= 0; i--) {
                    const star = this.stars[i];
                    star.y += star.speed;

                    // Draw star
                    this.ctx.fillStyle = '#FFD700';
                    this.ctx.beginPath();
                    for (let j = 0; j < 5; j++) {
                        const angle = (Math.PI * 2 * j) / 5 - Math.PI / 2;
                        const x = star.x + Math.cos(angle) * star.size;
                        const y = star.y + Math.sin(angle) * star.size;
                        if (j === 0) this.ctx.moveTo(x, y);
                        else this.ctx.lineTo(x, y);
                    }
                    this.ctx.closePath();
                    this.ctx.fill();

                    // Check collision
                    if (star.y > this.player.y && star.y < this.player.y + this.player.height &&
                        star.x > this.player.x && star.x < this.player.x + this.player.width) {
                        this.score += 10;
                        this.scoreElement.textContent = `Score: ${this.score}`;
                        this.stars.splice(i, 1);
                    } else if (star.y > this.canvasSize) {
                        this.stars.splice(i, 1);
                    }
                }

                // Update obstacles
                for (let i = this.obstacles.length - 1; i >= 0; i--) {
                    const obs = this.obstacles[i];
                    obs.y += obs.speed;

                    this.ctx.fillStyle = '#FF0000';
                    this.ctx.fillRect(obs.x, obs.y, obs.size, obs.size);

                    if (obs.y > this.player.y && obs.y < this.player.y + this.player.height &&
                        obs.x > this.player.x && obs.x < this.player.x + this.player.width) {
                        this.gameOver();
                        return;
                    }

                    if (obs.y > this.canvasSize) {
                        this.obstacles.splice(i, 1);
                    }
                }

                this.animationFrame = requestAnimationFrame(() => this.gameLoop());
            }

            gameOver() {
                this.started = false;
                this.ctx.fillStyle = 'rgba(0, 0, 0, 0.8)';
                this.ctx.fillRect(0, 0, this.canvasSize, this.canvasSize);
                this.ctx.fillStyle = '#FFD700';
                this.ctx.font = `${this.s(16)}px "Press Start 2P"`;
                this.ctx.textAlign = 'center';
                this.ctx.fillText('GAME OVER!', this.s(200), this.s(180));
                this.ctx.font = `${this.s(12)}px "Press Start 2P"`;
                this.ctx.fillText(`Score: ${this.score}`, this.s(200), this.s(220));
                this.ctx.font = `${this.s(10)}px "Press Start 2P"`;
                this.ctx.fillText('Tap to retry', this.s(200), this.s(270));
            }
        }

        const game1 = new DreamCatcher();
        game1.canvas.addEventListener('click', () => {
            if (!game1.active) game1.activate();
            if (!game1.started) game1.start();
            else if (!game1.active) game1.reset();
        });
        game1.canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            if (!game1.active) game1.activate();
            if (!game1.started) game1.start();
            else if (!game1.active) game1.reset();
        });

        // ===== GAME 2: AIRPORT RUSH =====
        class AirportRush extends Game {
            constructor() {
                const canvas = document.getElementById('game2');
                resizeCanvas(canvas);
                super('game2', canvas, document.getElementById('score2'));
                this.init();
            }

            init() {
                this.score = 0;
                this.player = { 
                    x: this.s(50), 
                    y: this.s(200), 
                    width: this.s(30), 
                    height: this.s(30), 
                    speed: this.s(4) 
                };
                this.gates = [];
                this.tickets = [];
                this.scoreElement.textContent = 'Score: 0';
                this.drawStartScreen();
            }

            drawStartScreen() {
                this.ctx.fillStyle = '#000';
                this.ctx.fillRect(0, 0, this.canvasSize, this.canvasSize);
                this.ctx.fillStyle = '#FFD700';
                this.ctx.font = `${this.s(16)}px "Press Start 2P"`;
                this.ctx.textAlign = 'center';
                this.ctx.fillText('AIRPORT RUSH', this.s(200), this.s(150));
                this.ctx.font = `${this.s(10)}px "Press Start 2P"`;
                this.ctx.fillText('Navigate gates!', this.s(200), this.s(200));
                this.ctx.fillText('Collect tickets!', this.s(200), this.s(230));
                this.ctx.fillText('Tap to start', this.s(200), this.s(280));
            }

            start() {
                this.activate();
                this.started = true;
                this.gameLoop();
            }

            gameLoop() {
                if (!this.active || !this.started) return;

                this.ctx.fillStyle = '#000';
                this.ctx.fillRect(0, 0, this.canvasSize, this.canvasSize);

                // Move player
                if ((keys['w'] || keys['arrowup'] || touches['up']) && this.player.y > 0) {
                    this.player.y -= this.player.speed;
                }
                if ((keys['s'] || keys['arrowdown'] || touches['down']) && this.player.y < this.canvasSize - this.player.height) {
                    this.player.y += this.player.speed;
                }

                // Draw player (plane)
                this.ctx.fillStyle = '#1E90FF';
                this.ctx.beginPath();
                this.ctx.moveTo(this.player.x + this.s(30), this.player.y + this.s(15));
                this.ctx.lineTo(this.player.x, this.player.y);
                this.ctx.lineTo(this.player.x, this.player.y + this.s(30));
                this.ctx.closePath();
                this.ctx.fill();

                // Spawn gates and tickets
                if (Math.random() < 0.015) {
                    const gapY = this.s(80) + Math.random() * this.s(100);
                    this.gates.push({
                        x: this.canvasSize,
                        gapY: gapY,
                        gapSize: this.s(120),
                        width: this.s(40),
                        speed: this.s(3),
                        passed: false
                    });
                }
                if (Math.random() < 0.02) {
                    this.tickets.push({
                        x: this.canvasSize,
                        y: this.s(50) + Math.random() * this.s(300),
                        size: this.s(20),
                        speed: this.s(3)
                    });
                }

                // Update gates
                for (let i = this.gates.length - 1; i >= 0; i--) {
                    const gate = this.gates[i];
                    gate.x -= gate.speed;

                    this.ctx.fillStyle = '#8B0000';
                    this.ctx.fillRect(gate.x, 0, gate.width, gate.gapY);
                    this.ctx.fillRect(gate.x, gate.gapY + gate.gapSize, gate.width, this.canvasSize - gate.gapY - gate.gapSize);

                    if (this.player.x + this.s(30) > gate.x && this.player.x < gate.x + gate.width) {
                        if (this.player.y < gate.gapY || this.player.y + this.s(30) > gate.gapY + gate.gapSize) {
                            this.gameOver();
                            return;
                        }
                        if (this.player.x > gate.x + gate.width - this.s(5) && !gate.passed) {
                            gate.passed = true;
                            this.score += 5;
                            this.scoreElement.textContent = `Score: ${this.score}`;
                        }
                    }

                    if (gate.x < -this.s(50)) {
                        this.gates.splice(i, 1);
                    }
                }

                // Update tickets
                for (let i = this.tickets.length - 1; i >= 0; i--) {
                    const ticket = this.tickets[i];
                    ticket.x -= ticket.speed;

                    this.ctx.fillStyle = '#FFD700';
                    this.ctx.fillRect(ticket.x, ticket.y, ticket.size, ticket.size);

                    if (this.player.x < ticket.x + ticket.size &&
                        this.player.x + this.s(30) > ticket.x &&
                        this.player.y < ticket.y + ticket.size &&
                        this.player.y + this.s(30) > ticket.y) {
                        this.score += 10;
                        this.scoreElement.textContent = `Score: ${this.score}`;
                        this.tickets.splice(i, 1);
                    }

                    if (ticket.x < -this.s(30)) {
                        this.tickets.splice(i, 1);
                    }
                }

                this.animationFrame = requestAnimationFrame(() => this.gameLoop());
            }

            gameOver() {
                this.started = false;
                this.ctx.fillStyle = 'rgba(0, 0, 0, 0.8)';
                this.ctx.fillRect(0, 0, this.canvasSize, this.canvasSize);
                this.ctx.fillStyle = '#FFD700';
                this.ctx.font = `${this.s(16)}px "Press Start 2P"`;
                this.ctx.textAlign = 'center';
                this.ctx.fillText('GAME OVER!', this.s(200), this.s(180));
                this.ctx.font = `${this.s(12)}px "Press Start 2P"`;
                this.ctx.fillText(`Score: ${this.score}`, this.s(200), this.s(220));
                this.ctx.font = `${this.s(10)}px "Press Start 2P"`;
                this.ctx.fillText('Tap to retry', this.s(200), this.s(270));
            }
        }

        const game2 = new AirportRush();
        game2.canvas.addEventListener('click', () => {
            if (!game2.active) game2.activate();
            if (!game2.started) game2.start();
            else if (!game2.active) game2.reset();
        });
        game2.canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            if (!game2.active) game2.activate();
            if (!game2.started) game2.start();
            else if (!game2.active) game2.reset();
        });

        // ===== GAME 3: CLOUD DODGER =====
        class CloudDodger extends Game {
            constructor() {
                const canvas = document.getElementById('game3');
                resizeCanvas(canvas);
                super('game3', canvas, document.getElementById('score3'));
                this.init();
            }

            init() {
                this.score = 0;
                this.player = { 
                    x: this.s(185), 
                    y: this.s(350), 
                    width: this.s(30), 
                    height: this.s(40), 
                    speed: this.s(5) 
                };
                this.clouds = [];
                this.cloudTimer = 0;
                this.scrollSpeed = this.s(2);
                this.scoreElement.textContent = 'Score: 0';
                this.drawStartScreen();
            }

            drawStartScreen() {
                this.ctx.fillStyle = '#87CEEB';
                this.ctx.fillRect(0, 0, this.canvasSize, this.canvasSize);
                this.ctx.fillStyle = '#000';
                this.ctx.font = `${this.s(16)}px "Press Start 2P"`;
                this.ctx.textAlign = 'center';
                this.ctx.fillText('CLOUD DODGER', this.s(200), this.s(150));
                this.ctx.font = `${this.s(10)}px "Press Start 2P"`;
                this.ctx.fillText('Avoid bad clouds!', this.s(200), this.s(200));
                this.ctx.fillText('Fly upward safely!', this.s(200), this.s(230));
                this.ctx.fillText('Tap to start', this.s(200), this.s(280));
            }

            start() {
                this.activate();
                this.started = true;
                this.gameLoop();
            }

            gameLoop() {
                if (!this.active || !this.started) return;

                this.ctx.fillStyle = '#87CEEB';
                this.ctx.fillRect(0, 0, this.canvasSize, this.canvasSize);

                // Move player
                if ((keys['a'] || keys['arrowleft'] || touches['left']) && this.player.x > 0) {
                    this.player.x -= this.player.speed;
                }
                if ((keys['d'] || keys['arrowright'] || touches['right']) && this.player.x < this.canvasSize - this.player.width) {
                    this.player.x += this.player.speed;
                }

                // Draw player (plane flying upward)
                this.ctx.fillStyle = '#FF6347';
                this.ctx.beginPath();
                this.ctx.moveTo(this.player.x + this.s(15), this.player.y);
                this.ctx.lineTo(this.player.x, this.player.y + this.s(40));
                this.ctx.lineTo(this.player.x + this.s(30), this.player.y + this.s(40));
                this.ctx.closePath();
                this.ctx.fill();

                // Wings
                this.ctx.fillStyle = '#DC143C';
                this.ctx.fillRect(this.player.x - this.s(5), this.player.y + this.s(20), this.s(10), this.s(15));
                this.ctx.fillRect(this.player.x + this.s(25), this.player.y + this.s(20), this.s(10), this.s(15));

                // Spawn clouds
                this.cloudTimer++;
                if (this.cloudTimer > 60) {
                    this.cloudTimer = 0;
                    const cloudWidth = this.s(60) + Math.random() * this.s(40);
                    const xPos = Math.random() * (this.canvasSize - cloudWidth);
                    this.clouds.push({
                        x: xPos,
                        y: -this.s(50),
                        width: cloudWidth,
                        height: this.s(40),
                        isBad: Math.random() < 0.7
                    });
                }

                // Update clouds
                for (let i = this.clouds.length - 1; i >= 0; i--) {
                    const cloud = this.clouds[i];
                    cloud.y += this.scrollSpeed;

                    // Draw cloud
                    if (cloud.isBad) {
                        this.ctx.fillStyle = '#696969';
                    } else {
                        this.ctx.fillStyle = '#FFFFFF';
                    }
                    
                    this.ctx.beginPath();
                    this.ctx.arc(cloud.x + this.s(15), cloud.y + this.s(15), this.s(12), 0, Math.PI * 2);
                    this.ctx.arc(cloud.x + cloud.width - this.s(15), cloud.y + this.s(15), this.s(12), 0, Math.PI * 2);
                    this.ctx.arc(cloud.x + cloud.width / 2, cloud.y + this.s(5), this.s(15), 0, Math.PI * 2);
                    this.ctx.fill();
                    this.ctx.fillRect(cloud.x + this.s(15), cloud.y + this.s(15), cloud.width - this.s(30), this.s(15));

                    // Check collision only with bad clouds
                    if (cloud.isBad) {
                        if (this.player.x + this.s(30) > cloud.x && 
                            this.player.x < cloud.x + cloud.width &&
                            this.player.y + this.s(40) > cloud.y && 
                            this.player.y < cloud.y + cloud.height) {
                            this.gameOver();
                            return;
                        }
                    }

                    if (cloud.y > this.canvasSize) {
                        this.clouds.splice(i, 1);
                        this.score += 10;
                        this.scoreElement.textContent = `Score: ${this.score}`;
                    }
                }

                this.animationFrame = requestAnimationFrame(() => this.gameLoop());
            }

            gameOver() {
                this.started = false;
                this.ctx.fillStyle = 'rgba(0, 0, 0, 0.8)';
                this.ctx.fillRect(0, 0, this.canvasSize, this.canvasSize);
                this.ctx.fillStyle = '#FFD700';
                this.ctx.font = `${this.s(16)}px "Press Start 2P"`;
                this.ctx.textAlign = 'center';
                this.ctx.fillText('CRASHED!', this.s(200), this.s(180));
                this.ctx.font = `${this.s(12)}px "Press Start 2P"`;
                this.ctx.fillText(`Score: ${this.score}`, this.s(200), this.s(220));
                this.ctx.font = `${this.s(10)}px "Press Start 2P"`;
                this.ctx.fillText('Tap to retry', this.s(200), this.s(270));
            }
        }

        const game3 = new CloudDodger();
        game3.canvas.addEventListener('click', () => {
            if (!game3.active) game3.activate();
            if (!game3.started) game3.start();
            else if (!game3.active) game3.reset();
        });
        game3.canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            if (!game3.active) game3.activate();
            if (!game3.started) game3.start();
            else if (!game3.active) game3.reset();
        });

        // ===== GAME 4: VISA MEMORY =====
        class VisaMemory extends Game {
            constructor() {
                const canvas = document.getElementById('game4');
                resizeCanvas(canvas);
                super('game4', canvas, document.getElementById('score4'));
                this.init();
            }

            init() {
                this.matchedPairs = 0;
                this.flippedCards = [];
                this.cards = [];
                this.cardTypes = ['🛂', '📋', '✈️', '🛫', '📄', '🎫', '🗂️', '📝'];
                const shuffled = [...this.cardTypes, ...this.cardTypes].sort(() => Math.random() - 0.5);
                
                for (let i = 0; i < 4; i++) {
                    for (let j = 0; j < 4; j++) {
                        this.cards.push({
                            x: j * this.s(90) + this.s(25),
                            y: i * this.s(90) + this.s(25),
                            width: this.s(80),
                            height: this.s(80),
                            type: shuffled[i * 4 + j],
                            flipped: false,
                            matched: false
                        });
                    }
                }
                this.scoreElement.textContent = 'Pairs: 0/8';
                this.drawStartScreen();
            }

            drawStartScreen() {
                this.ctx.fillStyle = '#000';
                this.ctx.fillRect(0, 0, this.canvasSize, this.canvasSize);
                this.ctx.fillStyle = '#FFD700';
                this.ctx.font = `${this.s(16)}px "Press Start 2P"`;
                this.ctx.textAlign = 'center';
                this.ctx.fillText('VISA PUZZLE', this.s(200), this.s(150));
                this.ctx.font = `${this.s(10)}px "Press Start 2P"`;
                this.ctx.fillText('Match pairs!', this.s(200), this.s(200));
                this.ctx.fillText('Tap to start', this.s(200), this.s(250));
            }

            start() {
                this.activate();
                this.started = true;
                this.draw();
            }

            draw() {
                this.ctx.fillStyle = '#000';
                this.ctx.fillRect(0, 0, this.canvasSize, this.canvasSize);

                this.cards.forEach(card => {
                    if (card.matched) {
                        this.ctx.fillStyle = '#2E8B57';
                    } else if (card.flipped) {
                        this.ctx.fillStyle = '#4169E1';
                    } else {
                        this.ctx.fillStyle = '#808080';
                    }
                    
                    this.ctx.fillRect(card.x, card.y, card.width, card.height);
                    this.ctx.strokeStyle = '#FFD700';
                    this.ctx.lineWidth = 2;
                    this.ctx.strokeRect(card.x, card.y, card.width, card.height);

                    if (card.flipped || card.matched) {
                        this.ctx.font = `${this.s(32)}px Arial`;
                        this.ctx.fillStyle = '#FFF';
                        this.ctx.textAlign = 'center';
                        this.ctx.textBaseline = 'middle';
                        this.ctx.fillText(card.type, card.x + card.width / 2, card.y + card.height / 2);
                    }
                });

                if (this.matchedPairs === 8) {
                    this.gameComplete();
                }
            }

            gameComplete() {
                this.ctx.fillStyle = 'rgba(0, 0, 0, 0.8)';
                this.ctx.fillRect(0, 0, this.canvasSize, this.canvasSize);
                this.ctx.fillStyle = '#FFD700';
                this.ctx.font = `${this.s(16)}px "Press Start 2P"`;
                this.ctx.textAlign = 'center';
                this.ctx.fillText('COMPLETED!', this.s(200), this.s(180));
                this.ctx.font = `${this.s(12)}px "Press Start 2P"`;
                this.ctx.fillText('All pairs matched!', this.s(200), this.s(220));
                this.ctx.font = `${this.s(10)}px "Press Start 2P"`;
                this.ctx.fillText('Tap to play again', this.s(200), this.s(270));
            }

            handleClick(e) {
                if (!this.started) {
                    this.start();
                    return;
                }

                if (this.matchedPairs === 8) {
                    this.reset();
                    return;
                }

                const rect = this.canvas.getBoundingClientRect();
                const scaleX = this.canvasSize / rect.width;
                const scaleY = this.canvasSize / rect.height;
                const x = (e.clientX - rect.left) * scaleX;
                const y = (e.clientY - rect.top) * scaleY;

                this.cards.forEach(card => {
                    if (x > card.x && x < card.x + card.width &&
                        y > card.y && y < card.y + card.height &&
                        !card.flipped && !card.matched && this.flippedCards.length < 2) {
                        
                        card.flipped = true;
                        this.flippedCards.push(card);

                        if (this.flippedCards.length === 2) {
                            setTimeout(() => {
                                if (this.flippedCards[0].type === this.flippedCards[1].type) {
                                    this.flippedCards[0].matched = true;
                                    this.flippedCards[1].matched = true;
                                    this.matchedPairs++;
                                    this.scoreElement.textContent = `Pairs: ${this.matchedPairs}/8`;
                                } else {
                                    this.flippedCards[0].flipped = false;
                                    this.flippedCards[1].flipped = false;
                                }
                                this.flippedCards = [];
                                this.draw();
                            }, 800);
                        }

                        this.draw();
                    }
                });
            }

            handleTouch(e) {
                e.preventDefault();
                if (e.touches.length > 0) {
                    const touch = e.touches[0];
                    this.handleClick(touch);
                }
            }
        }

        const game4 = new VisaMemory();
        game4.canvas.addEventListener('click', (e) => game4.handleClick(e));
        game4.canvas.addEventListener('touchstart', (e) => game4.handleTouch(e));

        // ===== GAME 5: SIGNAL CONNECT =====
        class SignalConnect extends Game {
            constructor() {
                const canvas = document.getElementById('game5');
                resizeCanvas(canvas);
                super('game5', canvas, document.getElementById('score5'));
                this.gridSize = 8;
                this.cellSize = this.canvasSize / this.gridSize;
                this.init();
            }

            init() {
                this.moves = 0;
                this.targetReached = false;
                this.grid = [];
                this.currentCell = { row: 0, col: 0 };
                
                for (let i = 0; i < this.gridSize; i++) {
                    this.grid[i] = [];
                    for (let j = 0; j < this.gridSize; j++) {
                        this.grid[i][j] = { active: false, type: 'empty' };
                    }
                }
                
                this.grid[0][0].type = 'start';
                this.grid[7][7].type = 'end';
                this.scoreElement.textContent = 'Moves: 0';
                this.drawStartScreen();
            }

            drawStartScreen() {
                this.ctx.fillStyle = '#000';
                this.ctx.fillRect(0, 0, this.canvasSize, this.canvasSize);
                this.ctx.fillStyle = '#FFD700';
                this.ctx.font = `${this.s(14)}px "Press Start 2P"`;
                this.ctx.textAlign = 'center';
                this.ctx.fillText('SIGNAL CONNECT', this.s(200), this.s(150));
                this.ctx.font = `${this.s(10)}px "Press Start 2P"`;
                this.ctx.fillText('Connect towers!', this.s(200), this.s(190));
                this.ctx.fillText('Tap tiles to path', this.s(200), this.s(220));
                this.ctx.fillText('Tap to start', this.s(200), this.s(270));
            }

            start() {
                this.activate();
                this.started = true;
                this.draw();
            }

            draw() {
                this.ctx.fillStyle = '#000';
                this.ctx.fillRect(0, 0, this.canvasSize, this.canvasSize);

                for (let i = 0; i < this.gridSize; i++) {
                    for (let j = 0; j < this.gridSize; j++) {
                        const x = j * this.cellSize;
                        const y = i * this.cellSize;
                        
                        if (this.grid[i][j].type === 'start') {
                            this.ctx.fillStyle = '#00FF00';
                        } else if (this.grid[i][j].type === 'end') {
                            this.ctx.fillStyle = '#FF0000';
                        } else if (this.grid[i][j].active) {
                            this.ctx.fillStyle = '#FFD700';
                        } else {
                            this.ctx.fillStyle = '#333';
                        }
                        
                        this.ctx.fillRect(x, y, this.cellSize - 2, this.cellSize - 2);
                    }
                }

                if (this.targetReached) {
                    this.gameComplete();
                }
            }

            gameComplete() {
                this.ctx.fillStyle = 'rgba(0, 0, 0, 0.8)';
                this.ctx.fillRect(0, 0, this.canvasSize, this.canvasSize);
                this.ctx.fillStyle = '#FFD700';
                this.ctx.font = `${this.s(16)}px "Press Start 2P"`;
                this.ctx.textAlign = 'center';
                this.ctx.fillText('CONNECTED!', this.s(200), this.s(180));
                this.ctx.font = `${this.s(12)}px "Press Start 2P"`;
                this.ctx.fillText(`Moves: ${this.moves}`, this.s(200), this.s(220));
                this.ctx.font = `${this.s(10)}px "Press Start 2P"`;
                this.ctx.fillText('Tap to play again', this.s(200), this.s(270));
            }

            handleClick(e) {
                if (!this.started) {
                    this.start();
                    return;
                }

                if (this.targetReached) {
                    this.reset();
                    return;
                }

                const rect = this.canvas.getBoundingClientRect();
                const scaleX = this.canvasSize / rect.width;
                const scaleY = this.canvasSize / rect.height;
                const x = (e.clientX - rect.left) * scaleX;
                const y = (e.clientY - rect.top) * scaleY;
                
                const col = Math.floor(x / this.cellSize);
                const row = Math.floor(y / this.cellSize);

                if (row >= 0 && row < this.gridSize && col >= 0 && col < this.gridSize) {
                    const isAdjacent = Math.abs(row - this.currentCell.row) + Math.abs(col - this.currentCell.col) === 1;
                    
                    if (isAdjacent && !this.grid[row][col].active && this.grid[row][col].type !== 'start') {
                        this.grid[row][col].active = true;
                        this.currentCell = { row, col };
                        this.moves++;
                        this.scoreElement.textContent = `Moves: ${this.moves}`;
                        
                        if (this.grid[row][col].type === 'end') {
                            this.targetReached = true;
                        }
                        
                        this.draw();
                    }
                }
            }

            handleTouch(e) {
                e.preventDefault();
                if (e.touches.length > 0) {
                    const touch = e.touches[0];
                    this.handleClick(touch);
                }
            }
        }

        const game5 = new SignalConnect();
        game5.canvas.addEventListener('click', (e) => game5.handleClick(e));
        game5.canvas.addEventListener('touchstart', (e) => game5.handleTouch(e));

        // ===== GAME 6: BUILDER'S CHALLENGE =====
        class BuildersChallenge extends Game {
            constructor() {
                const canvas = document.getElementById('game6');
                resizeCanvas(canvas);
                super('game6', canvas, document.getElementById('score6'));
                this.init();
            }

            init() {
                this.height = 0;
                this.stackedBlocks = [];
                this.movingBlock = {
                    x: 0,
                    y: this.s(50),
                    width: this.s(100),
                    height: this.s(30),
                    direction: 1,
                    speed: this.s(2)
                };
                this.baseBlock = { x: this.s(150), y: this.s(370), width: this.s(100), height: this.s(30) };
                this.scoreElement.textContent = 'Height: 0';
                this.drawStartScreen();
            }

            drawStartScreen() {
                this.ctx.fillStyle = '#87CEEB';
                this.ctx.fillRect(0, 0, this.canvasSize, this.canvasSize);
                this.ctx.fillStyle = '#000';
                this.ctx.font = `${this.s(14)}px "Press Start 2P"`;
                this.ctx.textAlign = 'center';
                this.ctx.fillText('BUILD FUTURE', this.s(200), this.s(150));
                this.ctx.font = `${this.s(10)}px "Press Start 2P"`;
                this.ctx.fillText('Stack blocks!', this.s(200), this.s(200));
                this.ctx.fillText('Tap to drop', this.s(200), this.s(230));
                this.ctx.fillText('Tap to start', this.s(200), this.s(280));
            }

            start() {
                this.activate();
                this.started = true;
                this.gameLoop();
            }

            gameLoop() {
                if (!this.active || !this.started) return;

                this.ctx.fillStyle = '#87CEEB';
                this.ctx.fillRect(0, 0, this.canvasSize, this.canvasSize);

                // Draw base
                this.ctx.fillStyle = '#8B4513';
                this.ctx.fillRect(this.baseBlock.x, this.baseBlock.y, this.baseBlock.width, this.baseBlock.height);

                // Draw stacked blocks
                this.stackedBlocks.forEach(block => {
                    this.ctx.fillStyle = '#FF6347';
                    this.ctx.fillRect(block.x, block.y, block.width, block.height);
                });

                // Move and draw current block
                if (this.movingBlock) {
                    this.movingBlock.x += this.movingBlock.direction * this.movingBlock.speed;
                    
                    if (this.movingBlock.x <= 0 || this.movingBlock.x + this.movingBlock.width >= this.canvasSize) {
                        this.movingBlock.direction *= -1;
                    }

                    this.ctx.fillStyle = '#4169E1';
                    this.ctx.fillRect(this.movingBlock.x, this.movingBlock.y, this.movingBlock.width, this.movingBlock.height);
                }

                this.animationFrame = requestAnimationFrame(() => this.gameLoop());
            }

            dropBlock() {
                if (!this.movingBlock) return;

                const targetBlock = this.stackedBlocks.length > 0 ? 
                    this.stackedBlocks[this.stackedBlocks.length - 1] : this.baseBlock;

                const overlap = Math.min(
                    this.movingBlock.x + this.movingBlock.width,
                    targetBlock.x + targetBlock.width
                ) - Math.max(this.movingBlock.x, targetBlock.x);

                if (overlap <= 0) {
                    this.gameOver();
                    return;
                }

                const newBlock = {
                    x: Math.max(this.movingBlock.x, targetBlock.x),
                    y: targetBlock.y - this.s(30),
                    width: overlap,
                    height: this.s(30)
                };

                this.stackedBlocks.push(newBlock);
                this.height++;
                this.scoreElement.textContent = `Height: ${this.height}`;

                this.movingBlock = {
                    x: 0,
                    y: newBlock.y - this.s(30),
                    width: newBlock.width,
                    height: this.s(30),
                    direction: 1,
                    speed: this.s(2) + this.height * this.s(0.1)
                };

                if (this.movingBlock.y < this.s(50)) {
                    this.gameOver();
                }
            }

            gameOver() {
                this.started = false;
                this.movingBlock = null;
                this.ctx.fillStyle = 'rgba(0, 0, 0, 0.8)';
                this.ctx.fillRect(0, 0, this.canvasSize, this.canvasSize);
                this.ctx.fillStyle = '#FFD700';
                this.ctx.font = `${this.s(16)}px "Press Start 2P"`;
                this.ctx.textAlign = 'center';
                this.ctx.fillText('GAME OVER!', this.s(200), this.s(180));
                this.ctx.font = `${this.s(12)}px "Press Start 2P"`;
                this.ctx.fillText(`Height: ${this.height}`, this.s(200), this.s(220));
                this.ctx.font = `${this.s(10)}px "Press Start 2P"`;
                this.ctx.fillText('Tap to retry', this.s(200), this.s(270));
            }
        }

        const game6 = new BuildersChallenge();
        game6.canvas.addEventListener('click', () => {
            if (!game6.active) game6.activate();
            if (!game6.started) game6.start();
            else if (game6.started && game6.movingBlock) game6.dropBlock();
            else if (!game6.active) game6.reset();
        });
        game6.canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            if (!game6.active) game6.activate();
            if (!game6.started) game6.start();
            else if (game6.started && game6.movingBlock) game6.dropBlock();
            else if (!game6.active) game6.reset();
        });

        // ===== GAME 7: MONEY RUNNER =====
        class MoneyRunner extends Game {
            constructor() {
                const canvas = document.getElementById('game7');
                resizeCanvas(canvas);
                super('game7', canvas, document.getElementById('score7'));
                this.init();
            }

            init() {
                this.coins = 0;
                this.player = {
                    x: this.s(50),
                    y: this.s(300),
                    width: this.s(30),
                    height: this.s(30),
                    velocityY: 0,
                    gravity: this.s(0.6),
                    jumpPower: this.s(-12),
                    onGround: true
                };
                this.obstacles = [];
                this.coinItems = [];
                this.gameSpeed = this.s(3);
                this.scoreElement.textContent = 'Coins: 0';
                this.drawStartScreen();
            }

            drawStartScreen() {
                this.ctx.fillStyle = '#87CEEB';
                this.ctx.fillRect(0, 0, this.canvasSize, this.canvasSize);
                this.ctx.fillStyle = '#8B4513';
                this.ctx.fillRect(0, this.s(330), this.canvasSize, this.s(70));
                this.ctx.fillStyle = '#000';
                this.ctx.font = `${this.s(16)}px "Press Start 2P"`;
                this.ctx.textAlign = 'center';
                this.ctx.fillText('MONEY RUNNER', this.s(200), this.s(150));
                this.ctx.font = `${this.s(10)}px "Press Start 2P"`;
                this.ctx.fillText('Collect coins!', this.s(200), this.s(200));
                this.ctx.fillText('Avoid obstacles!', this.s(200), this.s(230));
                this.ctx.fillText('Tap to start', this.s(200), this.s(280));
            }

            start() {
                this.activate();
                this.started = true;
                this.gameLoop();
            }

            gameLoop() {
                if (!this.active || !this.started) return;

                this.ctx.fillStyle = '#87CEEB';
                this.ctx.fillRect(0, 0, this.canvasSize, this.canvasSize);
                this.ctx.fillStyle = '#8B4513';
                this.ctx.fillRect(0, this.s(330), this.canvasSize, this.s(70));

                // Apply gravity
                this.player.velocityY += this.player.gravity;
                this.player.y += this.player.velocityY;

                if (this.player.y > this.s(300)) {
                    this.player.y = this.s(300);
                    this.player.velocityY = 0;
                    this.player.onGround = true;
                }

                // Draw player
                this.ctx.fillStyle = '#FFD700';
                this.ctx.fillRect(this.player.x, this.player.y, this.player.width, this.player.height);

                // Spawn items
                if (Math.random() < 0.02) {
                    this.obstacles.push({
                        x: this.canvasSize,
                        y: this.s(310),
                        width: this.s(20),
                        height: this.s(30)
                    });
                }
                if (Math.random() < 0.015) {
                    this.coinItems.push({
                        x: this.canvasSize,
                        y: this.s(250) - Math.random() * this.s(50),
                        size: this.s(20)
                    });
                }

                // Update obstacles
                for (let i = this.obstacles.length - 1; i >= 0; i--) {
                    const obs = this.obstacles[i];
                    obs.x -= this.gameSpeed;

                    this.ctx.fillStyle = '#8B0000';
                    this.ctx.fillRect(obs.x, obs.y, obs.width, obs.height);

                    if (this.player.x < obs.x + obs.width &&
                        this.player.x + this.player.width > obs.x &&
                        this.player.y < obs.y + obs.height &&
                        this.player.y + this.player.height > obs.y) {
                        this.gameOver();
                        return;
                    }

                    if (obs.x < -this.s(30)) {
                        this.obstacles.splice(i, 1);
                    }
                }

                // Update coins
                for (let i = this.coinItems.length - 1; i >= 0; i--) {
                    const coin = this.coinItems[i];
                    coin.x -= this.gameSpeed;

                    this.ctx.fillStyle = '#FFD700';
                    this.ctx.beginPath();
                    this.ctx.arc(coin.x, coin.y, coin.size / 2, 0, Math.PI * 2);
                    this.ctx.fill();

                    if (this.player.x < coin.x + coin.size / 2 &&
                        this.player.x + this.player.width > coin.x - coin.size / 2 &&
                        this.player.y < coin.y + coin.size / 2 &&
                        this.player.y + this.player.height > coin.y - coin.size / 2) {
                        this.coins += 10;
                        this.scoreElement.textContent = `Coins: ${this.coins}`;
                        this.coinItems.splice(i, 1);
                        this.gameSpeed += this.s(0.05);
                    }

                    if (coin.x < -this.s(30)) {
                        this.coinItems.splice(i, 1);
                    }
                }

                this.animationFrame = requestAnimationFrame(() => this.gameLoop());
            }

            gameOver() {
                this.started = false;
                this.ctx.fillStyle = 'rgba(0, 0, 0, 0.8)';
                this.ctx.fillRect(0, 0, this.canvasSize, this.canvasSize);
                this.ctx.fillStyle = '#FFD700';
                this.ctx.font = `${this.s(16)}px "Press Start 2P"`;
                this.ctx.textAlign = 'center';
                this.ctx.fillText('GAME OVER!', this.s(200), this.s(180));
                this.ctx.font = `${this.s(12)}px "Press Start 2P"`;
                this.ctx.fillText(`Coins: ${this.coins}`, this.s(200), this.s(220));
                this.ctx.font = `${this.s(10)}px "Press Start 2P"`;
                this.ctx.fillText('Tap to retry', this.s(200), this.s(270));
            }
        }

        const game7 = new MoneyRunner();
        game7.canvas.addEventListener('click', () => {
            if (!game7.active) game7.activate();
            if (!game7.started) {
                game7.start();
            } else if (game7.started && game7.player.onGround) {
                game7.player.velocityY = game7.player.jumpPower;
                game7.player.onGround = false;
            } else if (!game7.active) {
                game7.reset();
            }
        });
        game7.canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            if (!game7.active) game7.activate();
            if (!game7.started) {
                game7.start();
            } else if (game7.started && game7.player.onGround) {
                game7.player.velocityY = game7.player.jumpPower;
                game7.player.onGround = false;
            } else if (!game7.active) {
                game7.reset();
            }
        });

        // ===== GAME 8: COIN COLLECTOR =====
        class CoinCollector extends Game {
            constructor() {
                const canvas = document.getElementById('game8');
                resizeCanvas(canvas);
                super('game8', canvas, document.getElementById('score8'));
                this.init();
            }

            init() {
                this.savings = 0;
                this.timeLeft = 30;
                this.coins = [];
                this.timer = null;
                this.coinSpawner = null;
                this.scoreElement.textContent = 'Savings: 0';
                this.drawStartScreen();
            }

            drawStartScreen() {
                this.ctx.fillStyle = '#000';
                this.ctx.fillRect(0, 0, this.canvasSize, this.canvasSize);
                this.ctx.fillStyle = '#FFD700';
                this.ctx.font = `${this.s(14)}px "Press Start 2P"`;
                this.ctx.textAlign = 'center';
                this.ctx.fillText('COIN COLLECTOR', this.s(200), this.s(150));
                this.ctx.font = `${this.s(10)}px "Press Start 2P"`;
                this.ctx.fillText('Tap coins fast!', this.s(200), this.s(200));
                this.ctx.fillText('30 seconds!', this.s(200), this.s(230));
                this.ctx.fillText('Tap to start', this.s(200), this.s(280));
            }

            start() {
                this.activate();
                this.started = true;
                
                this.timer = setInterval(() => {
                    this.timeLeft--;
                    if (this.timeLeft <= 0) {
                        clearInterval(this.timer);
                        this.gameOver();
                    }
                }, 1000);

                this.coinSpawner = setInterval(() => {
                    if (this.active && this.started) {
                        this.coins.push({
                            x: this.s(50) + Math.random() * this.s(300),
                            y: this.s(50) + Math.random() * this.s(300),
                            size: this.s(30),
                            lifetime: 2000,
                            created: Date.now()
                        });
                    }
                }, 800);

                this.gameLoop();
            }

            gameLoop() {
                if (!this.active || !this.started) return;

                this.ctx.fillStyle = '#000';
                this.ctx.fillRect(0, 0, this.canvasSize, this.canvasSize);

                // Draw timer
                this.ctx.fillStyle = '#FFD700';
                this.ctx.font = `${this.s(14)}px "Press Start 2P"`;
                this.ctx.textAlign = 'center';
                this.ctx.fillText(`Time: ${this.timeLeft}s`, this.s(200), this.s(30));

                // Update and draw coins
                for (let i = this.coins.length - 1; i >= 0; i--) {
                    const coin = this.coins[i];
                    const age = Date.now() - coin.created;
                    
                    if (age > coin.lifetime) {
                        this.coins.splice(i, 1);
                        continue;
                    }

                    const opacity = 1 - (age / coin.lifetime);
                    this.ctx.fillStyle = `rgba(255, 215, 0, ${opacity})`;
                    this.ctx.beginPath();
                    this.ctx.arc(coin.x, coin.y, coin.size / 2, 0, Math.PI * 2);
                    this.ctx.fill();
                    
                    this.ctx.fillStyle = '#000';
                    this.ctx.font = `${this.s(16)}px Arial`;
                    this.ctx.fillText('💰', coin.x - this.s(8), coin.y + this.s(6));
                }

                this.animationFrame = requestAnimationFrame(() => this.gameLoop());
            }

            gameOver() {
                this.started = false;
                if (this.timer) clearInterval(this.timer);
                if (this.coinSpawner) clearInterval(this.coinSpawner);
                
                this.ctx.fillStyle = 'rgba(0, 0, 0, 0.9)';
                this.ctx.fillRect(0, 0, this.canvasSize, this.canvasSize);
                this.ctx.fillStyle = '#FFD700';
                this.ctx.font = `${this.s(16)}px "Press Start 2P"`;
                this.ctx.textAlign = 'center';
                this.ctx.fillText('TIME UP!', this.s(200), this.s(180));
                this.ctx.font = `${this.s(12)}px "Press Start 2P"`;
                this.ctx.fillText(`Saved: RM${this.savings}`, this.s(200), this.s(220));
                this.ctx.font = `${this.s(10)}px "Press Start 2P"`;
                this.ctx.fillText('Tap to play again', this.s(200), this.s(270));
            }

            handleClick(e) {
                if (!this.started) {
                    this.start();
                    return;
                }

                if (!this.active && this.timeLeft <= 0) {
                    this.reset();
                    return;
                }

                const rect = this.canvas.getBoundingClientRect();
                const scaleX = this.canvasSize / rect.width;
                const scaleY = this.canvasSize / rect.height;
                const x = (e.clientX - rect.left) * scaleX;
                const y = (e.clientY - rect.top) * scaleY;

                for (let i = this.coins.length - 1; i >= 0; i--) {
                    const coin = this.coins[i];
                    const distance = Math.sqrt(
                        Math.pow(x - coin.x, 2) + Math.pow(y - coin.y, 2)
                    );

                    if (distance < coin.size / 2) {
                        this.savings += 50;
                        this.scoreElement.textContent = `Savings: RM${this.savings}`;
                        this.coins.splice(i, 1);
                        break;
                    }
                }
            }

            handleTouch(e) {
                e.preventDefault();
                if (e.touches.length > 0) {
                    const touch = e.touches[0];
                    this.handleClick(touch);
                }
            }

            deactivate() {
                super.deactivate();
                if (this.timer) clearInterval(this.timer);
                if (this.coinSpawner) clearInterval(this.coinSpawner);
            }
        }

        const game8 = new CoinCollector();
        game8.canvas.addEventListener('click', (e) => game8.handleClick(e));
        game8.canvas.addEventListener('touchstart', (e) => game8.handleTouch(e));

        // ===== GAME 9: FIREWORKS =====
        class Fireworks extends Game {
            constructor() {
                const canvas = document.getElementById('game9');
                resizeCanvas(canvas);
                super('game9', canvas, document.getElementById('score9'));
                this.init();
            }

            init() {
                this.explosions = 0;
                this.particles = [];
                this.scoreElement.textContent = 'Explosions: 0';
                this.drawStartScreen();
            }

            drawStartScreen() {
                this.ctx.fillStyle = '#000033';
                this.ctx.fillRect(0, 0, this.canvasSize, this.canvasSize);
                this.ctx.fillStyle = '#FFD700';
                this.ctx.font = `${this.s(14)}px "Press Start 2P"`;
                this.ctx.textAlign = 'center';
                this.ctx.fillText('CELEBRATION!', this.s(200), this.s(150));
                this.ctx.font = `${this.s(10)}px "Press Start 2P"`;
                this.ctx.fillText('Tap for fireworks!', this.s(200), this.s(200));
                this.ctx.fillText('Celebrate success!', this.s(200), this.s(230));
                this.ctx.fillText('Tap anywhere!', this.s(200), this.s(280));
            }

            start() {
                this.activate();
                this.started = true;
                this.gameLoop();
            }

            gameLoop() {
                if (!this.active) return;

                this.ctx.fillStyle = 'rgba(0, 0, 51, 0.1)';
                this.ctx.fillRect(0, 0, this.canvasSize, this.canvasSize);

                for (let i = this.particles.length - 1; i >= 0; i--) {
                    const particle = this.particles[i];
                    particle.x += particle.vx;
                    particle.y += particle.vy;
                    particle.vy += this.s(0.1);
                    particle.life -= particle.decay;

                    if (particle.life <= 0) {
                        this.particles.splice(i, 1);
                        continue;
                    }

                    this.ctx.fillStyle = particle.color;
                    this.ctx.globalAlpha = particle.life;
                    this.ctx.beginPath();
                    this.ctx.arc(particle.x, particle.y, this.s(3), 0, Math.PI * 2);
                    this.ctx.fill();
                }

                this.ctx.globalAlpha = 1;

                if (this.explosions > 10) {
                    this.ctx.fillStyle = '#FFD700';
                    this.ctx.font = `${this.s(12)}px "Press Start 2P"`;
                    this.ctx.textAlign = 'center';
                    this.ctx.fillText('CONGRATULATIONS!', this.s(200), this.s(200));
                    this.ctx.font = `${this.s(10)}px "Press Start 2P"`;
                    this.ctx.fillText('You made it!', this.s(200), this.s(230));
                }

                this.animationFrame = requestAnimationFrame(() => this.gameLoop());
            }

            createFirework(x, y) {
                const colors = ['#FF0000', '#00FF00', '#0000FF', '#FFD700', '#FF00FF', '#00FFFF'];
                const color = colors[Math.floor(Math.random() * colors.length)];
                
                for (let i = 0; i < 30; i++) {
                    const angle = (Math.PI * 2 * i) / 30;
                    const speed = this.s(2) + Math.random() * this.s(3);
                    
                    this.particles.push({
                        x: x,
                        y: y,
                        vx: Math.cos(angle) * speed,
                        vy: Math.sin(angle) * speed,
                        color: color,
                        life: 1,
                        decay: 0.01 + Math.random() * 0.01
                    });
                }
                
                this.explosions++;
                this.scoreElement.textContent = `Explosions: ${this.explosions}`;
            }

            handleClick(e) {
                if (!this.started) {
                    this.start();
                }

                const rect = this.canvas.getBoundingClientRect();
                const scaleX = this.canvasSize / rect.width;
                const scaleY = this.canvasSize / rect.height;
                const x = (e.clientX - rect.left) * scaleX;
                const y = (e.clientY - rect.top) * scaleY;
                
                this.createFirework(x, y);
            }

            handleTouch(e) {
                e.preventDefault();
                if (e.touches.length > 0) {
                    const touch = e.touches[0];
                    this.handleClick(touch);
                }
            }
        }

        const game9 = new Fireworks();
        game9.canvas.addEventListener('click', (e) => game9.handleClick(e));
        game9.canvas.addEventListener('touchstart', (e) => game9.handleTouch(e));

        // ===== PROGRESS BAR FUNCTIONALITY =====
        const progressBar = document.getElementById('storyProgressBar');
        const progressDots = document.querySelectorAll('.progress-dot');
        const storyStages = document.querySelectorAll('.story-stage');

        function updateProgressDots() {
            const scrollPosition = window.scrollY + window.innerHeight / 2;
            const storySection = document.getElementById('story');
            const storyTop = storySection.offsetTop;
            
            storyStages.forEach((stage, index) => {
                const stageTop = storyTop + stage.offsetTop;
                const stageBottom = stageTop + stage.offsetHeight;
                
                if (scrollPosition >= stageTop && scrollPosition < stageBottom) {
                    progressDots[index].classList.add('active');
                    progressDots[index].classList.remove('completed');
                    
                    for (let i = 0; i < index; i++) {
                        progressDots[i].classList.remove('active');
                        progressDots[i].classList.add('completed');
                    }
                    
                    for (let i = index + 1; i < progressDots.length; i++) {
                        progressDots[i].classList.remove('active', 'completed');
                    }
                } else if (scrollPosition >= stageBottom) {
                    progressDots[index].classList.remove('active');
                    progressDots[index].classList.add('completed');
                }
            });
        }

        progressDots.forEach((dot, index) => {
            dot.addEventListener('click', () => {
                const targetStage = storyStages[index];
                if (targetStage) {
                    const headerOffset = 100;
                    const storySection = document.getElementById('story');
                    const storyTop = storySection.offsetTop;
                    const offsetPosition = storyTop + targetStage.offsetTop - headerOffset;

                    window.scrollTo({
                        top: offsetPosition,
                        behavior: 'smooth'
                    });
                }
            });
        });

        window.addEventListener('scroll', updateProgressDots, { passive: true });

        // ===== SMOOTH SCROLLING =====
        document.querySelectorAll('a[href*="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                const href = this.getAttribute('href');
                if (href.includes('#') && !href.startsWith('http')) {
                    const targetId = href.split('#')[1];
                    const target = document.getElementById(targetId);
                    if (target) {
                        e.preventDefault();
                        const headerOffset = 100;
                        const elementPosition = target.getBoundingClientRect().top;
                        const offsetPosition = elementPosition + window.pageYOffset - headerOffset;

                        window.scrollTo({
                            top: offsetPosition,
                            behavior: 'smooth'
                        });
                    }
                }
            });
        });

        // ===== WINDOW RESIZE HANDLER =====
        let resizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                // Resize all canvases
                allGames.forEach(game => {
                    const prevActive = game.active;
                    const prevStarted = game.started;
                    
                    resizeCanvas(game.canvas);
                    game.reset();
                    
                    if (prevActive && prevStarted) {
                        game.activate();
                    }
                });
            }, 250);
        });

        // ===== INTERSECTION OBSERVER FOR ANIMATIONS =====
        document.addEventListener('DOMContentLoaded', () => {
            updateProgressDots();

            const observerOptions = {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            };

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.style.opacity = '1';
                        entry.target.style.transform = 'translateY(0)';
                    }
                });
            }, observerOptions);

            const animateElements = document.querySelectorAll('.story-stage');
            animateElements.forEach((el, index) => {
                el.style.opacity = '0';
                el.style.transform = 'translateY(20px)';
                el.style.transition = `opacity 0.6s ease ${Math.min(index * 0.1, 1)}s, transform 0.6s ease ${Math.min(index * 0.1, 1)}s`;
                observer.observe(el);
            });

            window.addEventListener('beforeunload', () => {
                observer.disconnect();
            });
        });

        // ===== SPACEBAR HANDLER FOR DESKTOP =====
        window.addEventListener('keydown', (e) => {
            if (e.key === ' ' || e.key === 'Spacebar') {
                e.preventDefault();
                
                if (currentActiveGame) {
                    if (currentActiveGame === game1 || currentActiveGame === game2 || currentActiveGame === game3) {
                        if (!currentActiveGame.started && currentActiveGame.active) {
                            currentActiveGame.start();
                        } else if (!currentActiveGame.active) {
                            currentActiveGame.reset();
                        }
                    } else if (currentActiveGame === game6) {
                        if (!currentActiveGame.started && currentActiveGame.active) {
                            currentActiveGame.start();
                        } else if (currentActiveGame.started && currentActiveGame.movingBlock) {
                            currentActiveGame.dropBlock();
                        } else if (!currentActiveGame.active) {
                            currentActiveGame.reset();
                        }
                    } else if (currentActiveGame === game7) {
                        if (!currentActiveGame.started && currentActiveGame.active) {
                            currentActiveGame.start();
                        } else if (currentActiveGame.started && currentActiveGame.player.onGround) {
                            currentActiveGame.player.velocityY = currentActiveGame.player.jumpPower;
                            currentActiveGame.player.onGround = false;
                        } else if (!currentActiveGame.active) {
                            currentActiveGame.reset();
                        }
                    }
                }
            }
        });

        // ===== PREVENT PULL-TO-REFRESH ON MOBILE =====
        let touchStartY = 0;
        document.addEventListener('touchstart', (e) => {
            touchStartY = e.touches[0].clientY;
        }, { passive: true });

        document.addEventListener('touchmove', (e) => {
            const touchY = e.touches[0].clientY;
            const touchDiff = touchY - touchStartY;
            
            if (touchDiff > 0 && window.scrollY === 0) {
                e.preventDefault();
            }
        }, { passive: false });

        // ===== PERFORMANCE OPTIMIZATION =====
        // Pause inactive games when scrolling
        let scrollTimeout;
        window.addEventListener('scroll', () => {
            clearTimeout(scrollTimeout);
            scrollTimeout = setTimeout(() => {
                updateProgressDots();
            }, 100);
        }, { passive: true });

        // Visibility change handler
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                // Pause all games when tab is not visible
                allGames.forEach(game => {
                    if (game.started) {
                        game.deactivate();
                    }
                });
            }
        });

        // Log when games are ready
        console.log('X\'PAT Journey Games initialized - ' + allGames.length + ' games ready!');
        console.log('Mobile device detected:', isMobile);
    </script>
</body>
</html>